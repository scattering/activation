<!DOCTYPE html>
<html lang="en">
    <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <!---
        Setting viewport makes for a worse experience on iPhone SE but a
        better experience on android chrome. Android is worser than
        iPhone is better so set it.
    -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Neutron Activation and Scattering Calculator</title>
    <link rel="shortcut icon" href="favicon.ico">

    <script type="text/javascript" src="jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="jquery.tablesorter-2.0.5b.min.js"></script>

    <style type="text/css">
        body { position: absolute; }
        @media screen and (max-width: 10cm) {
            body { font-size: 9pt; }
        }
        /*body { font-size: 16pt; }*/
        input, select, textarea, button {
            font-family: inherit;
            font-size: inherit;
        }
        @media print
        {
            body { font-size: 10pt !important; }
            table, caption, th, td {
                font-size: 10pt !important;
                /* border: 0.1pt solid lightgray !important; */
                border: none !important;
            }
            /* Suppress screen-only when printing */
            .screen-only { display: none !important; height: 0; }
            .screen-only *{ display: none !important; height: 0; }
        }
        @media screen
        {
            /* Suppress print-only when displaying on screen */
            .print-only { display: none; }
            .print-only *{ display: none; }
        }

        p { margin-bottom: 0; }
        #footer p { margin-top: 0; }
        #footer { width: 100%; }
        #footer-left { float: left; }
        #footer-right { float: right; }
        /* body { font-size: 0.9em; } */
        .disabled { opacity: 0.3; }
        label { font-weight: inherit; }
        .controls input { width: 100%; }
        table { margin: 0; padding: 0; border-spacing: 0; border-color: lightgray; }
        caption, td, th { padding: 0.2ex 0.5em 0.2ex 0.5em; }
        th { vertical-align: baseline; }
        tbody tr:nth-child(2n) th, tbody tr.even th,
        tbody tr:nth-child(2n) td, tbody tr.even td,
        ul li:nth-child(2n), ol li:nth-child(2n) { background: inherit; /* background: none repeat scroll 0 0 #F3F3F9; */ }
        table.tablesorter thead tr .headerSortable {
            background-image: url(resonance-theme/bg.gif);
            background-repeat: no-repeat;
            background-position: center right;
            padding-right: 2em; /* space for sort arrows */
        }
        table.tablesorter thead tr .headerSortUp {
            background-image: url(resonance-theme/asc.gif);
        }
        table.tablesorter thead tr .headerSortDown {
            background-image: url(resonance-theme/desc.gif);
        }

        /* Cleaner time help table when space is limited. */
        #help_time_off th { text-align: left; }
        #help_time_off caption, td, th { padding: 0.2ex 0.5em 0.2ex 0.0em; }
        #help_time_off .timecol { min-width: 9.1em; }

        /* output markup */
        .error { color: red; }
        p.disclaimer { color: darkred; font-size:1.2em; }

        /* Make the formula box expand to the available width. */
        #material-panel table { display: table; width: 100%; }

        div.cutoff { display: block; }
        div.nocutoff { display: none; }
        button.activity_button { float: right; }


        /* IE requires the -ms- vendor tag for grid attributes. */
        /* frame layout */
        #content-frame {
            display:-ms-grid;
            display:grid;
        }
        #activation-frame {
            -ms-grid-column:1; -ms-grid-row:1;
            grid-column:1; grid-row:1;
            width:30em;
            }
        #help-frame {
            -ms-grid-column:2; -ms-grid-row:1;
            grid-column:2; grid-row:1;
            overflow:hidden;
            margin-left:0.5em;
            margin-right:0em;
            min-width:16em; max-width:40em;
            padding-right:0.5em;
            overflow-y:scroll;
            height:35ex; /* will be replaced by activation-frame height in js */
        }
        #results-frame {
            -ms-grid-column:1/3; -ms-grid-row:2;
            -ms-overflow-style: none; /* hide vertical scrollbar in IE */
            grid-column:1/3; grid-row:2;
            height:auto;
            overflow-y:scroll;
        }
        #results-frame::-webkit-scrollbar { width: 0 !important }
        div.control-group { margin-left: 0.5em; vertical-align: bottom; }
        /* div.control-group { height: 3ex; width: 15em; } */
        /* .help starts display:none so that size is initially zero. */
        .help { display:block; }
        /*.help dl { margin-left: 30em; }
        .help ol { margin-left: 30em; }
        .help p { margin-left: 30em; }
        */
        .help h3 { margin-top: 0.25em; }
        .help dd { margin-left: 1em; }
        .help dt { margin-left: 0em; padding: 0.3em; font-weight: bold; }
        .help ol { list-style-position: inside; padding-left: 0em; }
        .help li { margin-left: 0em; margin-bottom: 1ex; }
        .help div.bold { font-weight: bold; display: inline; }
        .help div.entrytext {
           display:inline;
           font-weight:bold;
           font-style:oblique;
        }
        .help div.example:before { content:"Example: "; }

        /* fading horizontal rule
        modified from http://konigi.com/tools/css-techniques-horizontal-rules
        */
        .help hr {
            width: 100%;
            height: 1px;
            margin: 2.4em 0;
            border: none;
            background: #ddd;
            background-image: -webkit-gradient(
                linear,
                left bottom,
                right bottom,
                color-stop(0, rgb(255,255,255)),
                color-stop(0.1, rgb(221,221,221)),
                color-stop(0.9, rgb(221,221,221)),
                color-stop(1, rgb(255,255,255))
            );
            background-image: -moz-linear-gradient(
                left center,
                rgb(255,255,255) 0%,
                rgb(221,221,221) 10%,
                rgb(221,221,221) 90%,
                rgb(255,255,255) 100%
            );
        }

        /* dictionary type: value on same line */
        dl.inline {
            display: -ms-grid; -ms-grid-template-columns: max-content auto;
            display: grid; grid-template-columns: max-content auto;
        }
        dl.inline dt {
            -ms-grid-column-start: 1;
            grid-column-start: 1;
            padding: 0.1em;
        }
        dl.inline dd {
            -ms-grid-column-start: 2;
            grid-column-start: 2;
            padding: 0.1em; margin-left: 0.5em;
        }

        .panel { border-radius:0.6em; border: 2pt solid gray; margin: 0.5em; padding: 0.5em; }
        .panel h3 { margin-top: -1em; margin-bottom: 0.3em; font-size: 1em; }
        .panel h3 .text { background: white; margin-left: 1em; padding: 0 0.3em 0 0.3em; }
        .panel { position: relative; }
        .panel .btn { position:absolute; right: 1em; top: 0.75em;}
        /* .panel .btn { position:absolute; top:1em; right:1em; } */

        /* Keep constant baseline spacing even with superscript/subscript */
        sup, sub {
            height: 0;
            line-height: 1;
            vertical-align: baseline;
            _vertical-align: bottom;
            position: relative;
        }
        sup { bottom: 1ex; }
        sub { top: .5ex; }
    </style>

<!--<script type="text/javascript" src="/static/lib/activation.js"></script>-->
<script type="text/javascript">
    // IE doesn't seem to support keys
    if(!Object.keys) Object.keys = function(o){
        if (o !== Object(o)) throw new TypeError('Object.keys called on non-object');
        var ret=[],p;
        for(p in o) if(Object.prototype.hasOwnProperty.call(o,p)) ret.push(p);
        return ret;
    }

    ELEMENTS = {"n": 0, "H": 1, "He": 2, "Li": 3, "Be": 4, "B": 5, "C": 6, "N": 7, "O": 8, "F": 9, "Ne": 10, "Na": 11, "Mg": 12, "Al": 13, "Si": 14, "P": 15, "S": 16, "Cl": 17, "Ar": 18, "K": 19, "Ca": 20, "Sc": 21, "Ti": 22, "V": 23, "Cr": 24, "Mn": 25, "Fe": 26, "Co": 27, "Ni": 28, "Cu": 29, "Zn": 30, "Ga": 31, "Ge": 32, "As": 33, "Se": 34, "Br": 35, "Kr": 36, "Rb": 37, "Sr": 38, "Y": 39, "Zr": 40, "Nb": 41, "Mo": 42, "Tc": 43, "Ru": 44, "Rh": 45, "Pd": 46, "Ag": 47, "Cd": 48, "In": 49, "Sn": 50, "Sb": 51, "Te": 52, "I": 53, "Xe": 54, "Cs": 55, "Ba": 56, "La": 57, "Ce": 58, "Pr": 59, "Nd": 60, "Pm": 61, "Sm": 62, "Eu": 63, "Gd": 64, "Tb": 65, "Dy": 66, "Ho": 67, "Er": 68, "Tm": 69, "Yb": 70, "Lu": 71, "Hf": 72, "Ta": 73, "W": 74, "Re": 75, "Os": 76, "Ir": 77, "Pt": 78, "Au": 79, "Hg": 80, "Tl": 81, "Pb": 82, "Bi": 83, "Po": 84, "At": 85, "Rn": 86, "Fr": 87, "Ra": 88, "Ac": 89, "Th": 90, "Pa": 91, "U": 92, "Np": 93, "Pu": 94, "Am": 95, "Cm": 96, "Bk": 97, "Cf": 98, "Es": 99, "Fm": 100, "Md": 101, "No": 102, "Lr": 103, "Rf": 104, "Db": 105, "Sg": 106, "Bh": 107, "Hs": 108, "Mt": 109, "Ds": 110, "Rg": 111, "Cn": 112, "Nh": 113, "Fl": 114, "Mc": 115, "Lv": 116, "Ts": 117, "Og": 118};
    ACTIVE_BUTTON = "activation";
    // Parse environment variables "index.html?cutoff=...&abundance=..."
    function getURLParameter(name) {
        var value = decodeURIComponent(
            (RegExp(name + '=' + '(.+?)(&|$)').exec(location.search)||[,null])[1]
            );
        return value;
    }
    // From Doron Grinzaig (2017-11-21)
    // https://stackoverflow.com/questions/14129953/how-to-encode-a-string-in-javascript-for-displaying-in-html
    function sanitize(html) {
        return $('<div>').text(html).html();
    }
    function format_activation_value(v, cutoff) {
        return (v<cutoff? '---' : v.toExponential(4));
    }
    function nice_number(v) {
        if (Math.abs(Math.round(v)-v) < 0.001) return Math.round(v);
        else return v.toFixed(1);
    }
    function format_mass(v) {
        if (v >= 1000.) return v.toFixed(0)+'&thinsp;g';
        else if (v >= 1.) return v.toFixed(3)+'&thinsp;g';
        else if (v >= 1e-3) return (1e3*v).toFixed(3)+'&thinsp;mg';
        else if (v >= 1e-6) return (1e6*v).toFixed(3)+'&thinsp;ug';
        else if (v >= 1e-9) return (1e9*v).toFixed(3)+'&thinsp;ng';
        else return v.toExponential(4)+'&thinsp;ng';
    }
    // standard year for activation calculations is 365, not 365.2425
    var HOURS_PER_YEAR = 365*24; // = 365.2425*24;
    function format_time(v) {
        if (v >= HOURS_PER_YEAR) return nice_number(v/HOURS_PER_YEAR)+' yrs';
        else if (v >= 48 || v == 24) return nice_number(v/24)+' days';
        else if (v >= 2 || v == 1) return nice_number(v)+' hrs';
        else if (v >= 2/60. | v == 1/60.) return nice_number(v*60)+' min';
        else return (v*3600).toPrecision(3)+' sec';
    }
    function parse_half_life(s) {
        var units = {y: 365*24*3600, d: 24*3600, h: 3600, m: 60, s: 1};
        var a = s.split(" ");
        var value_str = a[0], units_str = a[1];
        return parseFloat(value_str) * units[units_str];
    }
    function parse_isotope(s) {
        var a = s.split("-");
        var element = a[0], isotope = a[1];
        return ELEMENTS[element] + parseInt(isotope)/1000;
    }
    $.tablesorter.addParser({
        id: 'isotope',
        is: function (s) { return /^ *[A-Z][a-z]?-[0-9]+[sm+]* *$/.test(s); },
        format: function (s) { return parse_isotope(s); },
        type: 'numeric'
    });
    $.tablesorter.addParser({
        id: 'half-life',
        is: function (s) { return /^ *[0-9.+-eE]+ *[smhdy] *$/.test(s); },
        format: function (s) { return parse_half_life(s); },
        type: 'numeric'
    });
    $.tablesorter.addParser({
        id: 'float',
        is: function (s) { return /^ *[0-9.+-eE]+ *$/.test(s); },
        format: function (s) { return s == '---' ? 0. : parseFloat(s); },
        type: 'numeric'
    });

    function parse_url_parameters() {
        // Parse URL parameters.
        var cutoff_par = getURLParameter('cutoff');
        if (cutoff_par==='null') CUTOFF = 0.0005;
        else CUTOFF = Number(cutoff_par);
        if (isNaN(CUTOFF)) { // IE doesn't support Number.isNaN
            show_error("<p>cutoff="+sanitize(cutoff_par)+" in URL should be floating point μCi; default is 0.0005.</p>");
            CUTOFF = 0.0005;
        }
        CUTOFF_Bq = CUTOFF*37000;

        var decay_par = getURLParameter('decay');
        if (decay_par==='null') DECAY_LEVEL = CUTOFF>0?CUTOFF:0.0005;
        else DECAY_LEVEL = Number(decay_par)
        if (isNaN(DECAY_LEVEL)) { // IE doesn't support Number.isNaN
            show_error("<p>decay="+sanitize(decay_par)+" in URL should be floating point μCi; default is cutoff.</p>");
            DECAY_LEVEL = CUTOFF>0?CUTOFF:0.0005;
        }

        var abundance_par = getURLParameter('abundance');
        if (abundance_par==='null') ABUNDANCE = "IAEA";
        else ABUNDANCE = abundance_par;
        if (ABUNDANCE!=="NIST" && ABUNDANCE!=="IAEA") {
            show_error("<p>abundance="+sanitize(abundance_par)+" in URL should be NIST or IAEA; default is IAEA</p>");
            ABUNDANCE = "IAEA";
        }
    }

    function enable_forms() {
        // Enable forms; they are disabled by default so that noscript users
        // can't do anything.
        $('.container').removeClass("disabled");
        $('#id_chemical_formula').removeAttr("disabled");
        $('#id_submit_scat').removeAttr("disabled");
        $('#id_submit_act').removeAttr("disabled");
        $('a').each(function(){ this.tabIndex = -1; });
        $('.help').each(function(){ $(this).append("<hr>"); });
        $('input[type=text]').keydown(function(e) {
            if (e.keyCode == 13) {
                e.preventDefault();
                submit_query(ACTIVE_BUTTON);
            }
        });
        $('input[type=text]').focus(function(e) {
            var panel = $(this).closest('.panel')[0].id;
            if (panel == "scattering-panel") {
                ACTIVE_BUTTON = "scattering";
            } else if (panel == "activation-panel") {
                ACTIVE_BUTTON = "activation";
            }
        } );

        //$("#id-activationForm").submit(submit_query);
        $("#id-activationForm").submit(function(event) {event.preventDefault();});
        $('#id_submit_scat').click(function() { submit_query('scattering'); });
        $('#id_submit_act').click(function() { submit_query('activation'); });
    }

    function submit_query(target){
        ACTIVE_BUTTON = target;
        $.ajax({
            type:"POST",
            url:"/cgi-bin/nact.py",
            data: {
                calculate: target,
                sample: $('input:text[id=id_chemical_formula]').val(),
                flux: $('input:text[id=id_flux]').val(),
                fast: $('input:text[id=id_fast_ratio]').val(),
                Cd: $('input:text[id=id_Cd_ratio]').val(),
                mass: $('input:text[id=id_mass]').val(),
                density: $('input:text[id=id_density]').val(),
                thickness: $('input:text[id=id_thickness]').val(),
                wavelength: $('input:text[id=id_wavelength]').val(),
                xray: $('input:text[id=id_xray]').val(),
                exposure: $('input:text[id=id_time_on]').val(),
                rest: [0,1,24,360,$('input:text[id=id_time_off]').val()],
                decay: DECAY_LEVEL,
                //abundance: $('input:text[id=id_abundance]').val()
                abundance: ABUNDANCE
            },
            complete: function (xhr, status) {
                //console.log(status);
                if (status==="parsererror") {
                    process_response({'success':false,'detail':{'JSON response':'parse error in return value---maybe NaN or Inf?'}});
                }  else if (status!=="success") {
                    process_response({'success':false,'detail':{'status error':status}});
                }
            },
            //error: function (xhr, status, err) { console.log("error",error); },
            success: process_response
        });
    }

    function cssrule(class_name){
        var ss = document.styleSheets;
        for (var i=0; i<ss.length; i++) {
            var ss = document.styleSheets;
            var rules = ss[i].cssRules || ss[i].rules;
            for (var j=0; j<rules.length; j++) {
                if (rules[j].selectorText === class_name) {
                    return rules[j];
                }
            }
        }
    }
    function show_cutoff(state) {
        if (state) {
            cssrule('div.cutoff').style.display = 'block';
            cssrule('div.nocutoff').style.display = 'none';
        } else {
            cssrule('div.cutoff').style.display = 'none';
            cssrule('div.nocutoff').style.display = 'block';
        }
    }
    function activation_table(act, cutoff) {
        var data = {};
        var content = "";
        //construct headers
        data.headers=["element","reaction","product","half life","0 hrs","1 hr", "24 hrs", "15 days", format_time(act.rest[4])]
        data.sorters = ['isotope', 'text', 'isotope', 'half-life', 'float', 'float', 'float', 'float', 'float'];
        data.rows=[]
        for (var i=0; i < act.activity.length; i++){
            var active = false, row=act.activity[i];
            var columns = [row.isotope, row.reaction, row.product, row.halflife];
            for (var j=0; j < row.levels.length; j++){
                active = active || (row.levels[j] >= cutoff);
                columns.push(row.levels[j])
            }
            if (active) data.rows.push(columns);
        }

        var activity_header, activity_button;
        if (cutoff>0) {
            activity_header = 'Activity (&mu;Ci) above ' + cutoff.toExponential(4) + ' &mu;Ci';
            activity_button = '<button class="activity_button screen-only" onClick="show_cutoff(false);event.stopPropagation();">All</button>';
        } else if (CUTOFF>0) {
            activity_header = 'Activity (&mu;Ci)';
            activity_button = '<button class="activity_button screen-only" onClick="show_cutoff(true);event.stopPropagation();">&gt;'+CUTOFF.toExponential(4)+'&thinsp;&mu;Ci</button>';
        } else {
            activity_header = 'Activity (&mu;Ci)';
            activity_button = '';
        }
        //add headers to table
        content += '<table border=1 class="tablesorter">\n <thead>\n';
        content += '  <tr class="header {sorter:false}"><th colspan="4" /><th colspan="5" class="{sorter:false}">'+activity_header+activity_button+'</th></tr>\n';
        content += '  <tr class="header">';
        for (var i in data.headers) {
            content += '<th class="headerSortable {sorter: \'' + data.sorters[i] + '\')">' + data.headers[i] + '</th>';
        }
        content += '</tr>\n </thead>\n <tbody>\n'
        for (var i in data.rows) {
            content += '  <tr id="' + i + '">';
            for (var j=0; j <data.rows[i].length; j++){
                if (j>=4) {
                    content += '<td>'+format_activation_value(data.rows[i][j], cutoff)+'</td>';
                } else {
                    content += '<td>' + data.rows[i][j] + '</td>';
                }
            }
            content += '</tr>\n';
        }
        content += ' </tbody>\n <tfoot>\n  <tr class="header"><th colspan="4">total activity</th>';
        for (var j=0; j < act.total.length; j++) {
            content += '<td>'+format_activation_value(act.total[j], cutoff)+'</td>';
        }
        content += '</tr>\n </tfoot>\n </table>\n';
        return content;
    }
    function show_error(error_html) {
        var content = '<div class="result error"><hr />\n';
        content += error_html;
        content += '</div>\n';
        $(content).prependTo('div[id=results]');
    }
    function process_response(ldata) {
        //console.log(ldata);
        if (typeof(ldata)==="string") ldata=$.parseJSON(ldata);
        if (!ldata.success) {
            var error_html = '';
            var keys = Object.keys(ldata.detail);
            keys.sort();
            for (i = keys.length-1; i >= 0; i--) {
                error_html += '<pre class="error">Error ' +sanitize(keys[i])+': '+sanitize(ldata.detail[keys[i]])+'</pre>\n';
            }
            show_error(error_html);
            return;
        }

        var act = ldata.activation;
        var sample = ldata.sample;
        var scat = ldata.scattering;
        var xscat = ldata.xray_scattering;
        var content = '<div class="result"><hr>\n';

        if (typeof act == 'undefined') {
            // do nothing if not returned
        } else if ("error" in act) {
            // Restricted title
            content += '<p>activation calculation failed with</p><pre>\n'+sanitize(act.error)+'</pre>\n';
        } else {
            // Full title
            content += '<h3>Activation of ' + sample.name + ' after ' + format_time(act.exposure)+' at '+act.flux.toPrecision(3)+' n/cm<sup>2</sup>/s</h3>\n';

            // Disclaimer
            content += '<p class="disclaimer">Estimated activation only. All samples must be evaluated by NIST Health Physics to determine if and how the sample can be removed from the NCNR.</p>';

            // Atoms
            content += '<p>Sample in beam: ' + format_mass(sample.mass) + ' of ' + sanitize(sample.formula) + '\n';

            // Rabbit parameters
            if (act.Cd > 0 || act.fast > 0) {
                content += '<br>Rabbit system: Cd ratio = ' + act.Cd + ', thermal/fast ratio = ' + act.fast + '\n'
            }

            // Decay time
            if (act.decay_time > 0) {
                content += '<br>Time to decay below '+act.decay_level.toExponential(4)+' &mu;Ci is '+format_time(act.decay_time);
                /* TODO: show cool-off date.
                The implementation below will confuse users since cool-off date is relative
                to the time off beam rather than the current time. This is okay when the
                "Decay" field is set for an existing sample, but the common case is to
                estimate activation for a sample you are planning to put on the beam not
                one that you have already measured and removed. We could tweak the interface
                so that we only display the cool-off date when decay time is negative or
                decay time is a time stamp, or we could just live with the confusion.
                I'm going to punt on this for now.
                // Add the "cool" date/time as the current time minus off beam time plus decay time.
                var decay_delta = act.decay_time - act.rest[4]; // in hours
                if (decay_delta < 0) {
                    // Already past, print nothing.
                } else if (decay_delta < 7*24) {
                    // Cool within one week: print date and time
                    var decay_date = new Date(Date.now() + 1000*3600*decay_delta); // js timestamp is in ms
                    content += ' [date: ' + decay_date.toLocaleString() + ']';
                } else if (decay_delta < HOURS_PER_YEAR*100) {
                    // Cool within one century, print date
                    decay_delta += 26; // Force anything after 6AM into the next day
                    var decay_date = new Date(Date.now() + 1000*3600*decay_delta); // js timestamp is in ms
                    content += ' [date: ' + decay_date.toLocaleDateString() + ']';
                } else {
                    // More than a century in the future; print nothing.
                }
                */
                content += "\n";
            }
            content += '</p>\n'

            // Activation table
            if (CUTOFF == 0.) {
                content += activation_table(act, 0.);
            } else {
                content += '<div class="cutoff">\n' + activation_table(act, CUTOFF) + '</div>\n';
                content += '<div class="nocutoff">\n' + activation_table(act, 0.) + '</div>\n';
            }
        }


        if (typeof scat == 'undefined') {
            // do nothing if not returned
        } else if ("error" in scat) {
            content += '<p>neutron scattering calculation failed with</p><pre>\n'+sanitize(scat.error)+'</pre>\n';
        } else if ("error" in xscat) {
            content += '<p>X-ray scattering calculation failed with</p><pre>\n'+sanitize(xscat.error)+'</pre>\n';
        } else {
            // Drop coherent cross section from penetration depth calculation.
            // An alternative formulation, based on total scattering b, would be
            // penetration = 1/(1/scat.penetration - scat.xs.coh), which perhaps
            // takes diffuse coherent scattering into account [Glinka 2011].
            var penetration = 1 /(scat.xs.abs+scat.xs.incoh);
            var transmission = 100*Math.exp(-sample.thickness/penetration);
            var flux_str = $('input:text[id=id_flux]').val();
            var transmitted_flux = parseFloat(flux_str)*transmission/100.0;

            // Mass density
            var density_str = $('input:text[id=id_density]').val();
            content += "<h3>Scattering from " + sanitize(sample.name) + "</h3>";

            // Source neutrons
            content += "<p>Source neutrons: "
                + scat.neutron.wavelength.toFixed(3) + "&thinsp;&Aring;"
                + " = "+scat.neutron.energy.toFixed(2) + "&thinsp;meV"
                + " = "+scat.neutron.velocity.toFixed(0) + "&thinsp;m/s<br>";
            content += "Source X-rays: "
                + xscat.xray.wavelength.toFixed(3) + "&thinsp;&Aring;"
                + " = " + xscat.xray.energy.toFixed(3) + "&thinsp;keV<br>";
            // Atoms
            content += "Sample in beam: " + sanitize(sample.formula) + " at " + sample.density.toFixed(2) + "&thinsp;g/cm<sup>3</sup>";
            if (density_str.indexOf(':') !== -1) content += " from lattice "+sanitize(density_str);
            content += "</p>";

            // Neutron scattering
            content += '<table border=1>\n <tr>';
            content += '<th colspan="2">1/e penetration depth<br />(cm)</th>';
            content += '<th colspan="2">Scattering length density<br />(10<sup>-6</sup>/&Aring;<sup>2</sup>)</th>';
            content += '<th colspan="2">Scattering cross section<br />(1/cm)</th>';
            content += '<th colspan="2">X-ray SLD<br />(10<sup>-6</sup>/&Aring;<sup>2</sup>)</th>';
            content += '</tr>\n <tr>';
            content += '<th>abs</th><td>'+(1/scat.xs.abs).toFixed(3)+'</td>';
            content += "<th>real</th><td>"+scat.sld.real.toFixed(3)+'</td>';
            content += '<th>coh</th><td>'+scat.xs.coh.toFixed(3)+'</td>';
            content += "<th>real</th><td>"+xscat.sld.real.toFixed(3)+'</td>';
            content += '</tr>\n <tr>';
            content += '<th>abs+incoh</th><td>'+(1/(scat.xs.incoh+scat.xs.abs)).toFixed(3)+'</td>';
            content += "<th>imag</th><td>"+(-scat.sld.imag).toFixed(3)+'</td>';
            content += '<th>abs</th><td>'+scat.xs.abs.toFixed(3)+'</td>';
            content += "<th>imag</th><td>"+(-xscat.sld.imag).toFixed(3)+'</td>';
            content += '</tr>\n <tr>';
            content += '<th>abs+incoh+coh</th><td>'+scat.penetration.toFixed(3)+'</td>';
            content += '<th>incoh</th><td>'+scat.sld.incoh.toFixed(3)+'</td>';
            content += '<th>incoh</th><td>'+scat.xs.incoh.toFixed(3)+'</td>';
            content += '<th></th><td>'+''+'</td>';
            content += '</tr>\n <tr>';
            content += '</tr>\n</table>';

            // Neutron transmission
            content += '<p>Neutron transmission is '
                    +(transmission>=2||transmitted_flux<CUTOFF_Bq
                      ? transmission.toFixed(2)
                      : transmission.toPrecision(3))
                    +'% for '+sample.thickness+'&thinsp;cm of sample'
                    +' (after absorption and incoherent scattering).\n';
            content += '<br>Transmitted flux is '
                    +transmitted_flux.toPrecision(4)+'&thinsp;n/cm<sup>2</sup>/s'
                    +' for a '+sanitize(flux_str)+'&thinsp;n/cm<sup>2</sup>/s beam.\n';

            // Contrast match
            if (scat.contrast_match.D2O_fraction === null) {
                content += "</p>";
            } else {
                content += '<br>Contrast match point: ';
                if (scat.contrast_match.D2O_fraction < 0) {
                    content += '&lt; 0% D<sub>2</sub>O</p>\n';
                } else if (scat.contrast_match.D2O_fraction > 1) {
                    content += '&gt; 100% D<sub>2</sub>O</p>\n';
                } else {
                    console.log(scat.sld, scat);
                    content += (scat.contrast_match.D2O_fraction*100).toFixed(1)
                            + '% D<sub>2</sub>O by volume (real SLD = '
                            + scat.contrast_match.sld.toFixed(3)
                            + '&times;10<sup>-6</sup>/&Aring;<sup>2</sup>)</p>\n';
                }
            }
        }

        // End of div
        content += '</div>\n';

        $(content).prependTo('div[id=results]'); //add to the dom
        $("table").tablesorter({sortList: [[8,1]]});
        scroll_to_result();
    }

    function scroll_to_result(){
        var opt = {behavior: "smooth", block: "nearest"};
        document.getElementById("results").firstChild.scrollIntoView(opt);
    }
    // Dynamic help support.  Clicking an input field jumps to the
    // corresponding section of the help.  Input "gork" uses:
    //    <input id="id_gork" ...>
    // and the corresponding help section uses:
    //    <div class="help" id="help_gork"><h3>Gork Section Title</h3>...</div>
    function help_jump(section_name){
        var section = document.getElementById(section_name);
        var frame = document.getElementById('help-frame');
        if (!!section) {
            frame.scrollTop = section.offsetTop - frame.offsetTop;
        }
    }

    function setup_help() {
        $('#help-frame').height($('#activation-frame').height());
        $('input').focusin(function(){help_jump("help_"+this.id.slice(3))});
        $('.cite').click(function(event){
            event.preventDefault();
            help_jump(this.getAttribute('href').substring(1))
        });
    }

    $(document).ready(function () {
        parse_url_parameters();
        enable_forms();
        setup_help();
        var timestamp = (new Date(Date.parse(document.lastModified))).toLocaleDateString();
        document.getElementById("lastmod-timestamp").innerHTML = timestamp;
    });
</script>

</head>
<body>

<div class="screen-only">
<?php
  include("/var/www/include/navigation.inc");
  include("/var/www/include/utility.inc");
?>
<!-- Snapshot of navigation.inc and utility.inc from 2022-05-18. Move the
    ENDCOMMENT line above the table to show the banner from the local server.
<table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tbody><tr align="center" valign="bottom">
     <td background="https://www.ncnr.nist.gov/images/ncnr_banner_tile_2.png">
      <table width="90%" border="0" cellpadding="0" cellspacing="0" height="66">
       <tbody><tr valign="middle">
        <td align="left">
   <a href="#MainContent" tabindex="-1"><img src="https://www.ncnr.nist.gov/Hidden.gif" width="1" height="1" alt="skip to main content" align="left" border="0"></a>
         <img src="https://www.ncnr.nist.gov/images/ncnr_banner_title_2.gif" alt="NIST Center for Neutron Research" ismap="" border="0" usemap="#ncnrmap">
         <map name="ncnrmap">
          <area shape="rect" coords="0,19,355,40" href="http://www.ncnr.nist.gov/" alt="NIST Center for Neutron Research">
         </map>
        </td>
        <td align="right">
         <a href="http://www.nist.gov/" tabindex="-1">
          <img src="https://www.ncnr.nist.gov/images/ncnr_banner_nist_name.gif" alt="National Institute of Standards and Technology" border="0">
         </a>
        </td>
       </tr>
      </tbody></table>
     </td>
    </tr>
   </tbody></table>
   <table width="100%" cellpadding="0" cellspacing="0" border="0">
    <tbody><tr align="center">
     <td bgcolor="#ccccff">
          <a href="https://nist.gov/ncnr" tabindex="-1">
          <font face="arial, helvetica, sans-serif" color="#663399" size="3"><b>Home
          </b></font></a></td>
     <td bgcolor="#ccccff">
          <a href="https://www.ncnr.nist.gov/ipeek" tabindex="-1">
          <font face="arial, helvetica, sans-serif" color="#663399" size="3"><b>Live Data
          </b></font></a></td>
     <td bgcolor="#ccccff">
          <a href="https://nist.gov/ncnr/neutron-instruments" tabindex="-1">
          <font face="arial, helvetica, sans-serif" color="#663399" size="3"><b>Instruments
          </b></font></a></td>
     <td bgcolor="#ccccff">
          <a href="https://nist.gov/ncnr/chrns" tabindex="-1">
          <font face="arial, helvetica, sans-serif" color="#663399" size="3"><b>CHRNS
          </b></font></a></td>
     <td bgcolor="#ccccff">
          <a href="https://nist.gov/ncnr/call-proposals" tabindex="-1">
          <font face="arial, helvetica, sans-serif" color="#663399" size="3"><b>Proposals
          </b></font></a></td>
     </tr>
  </tbody></table>
ENDCOMMENT -->
<!-- end snapshot -->
</div>

<noscript>
<h3>Enable javascript to run the activation calculator.</h3><hr />
</noscript>

<div id="content-frame" class="container disabled">

    <div id="activation-frame" class="screen-only">

        <form id="id-activationForm" class="blueForms" method="post">

            <div class="panel" id="material-panel">
            <h3><span class="text">Material</span></h3>
            <table><tbody>
            <tr>
              <td>
               <div class="controls"><input id="id_chemical_formula" type="text" class="textinput textInput" name="chemical_formula" value="Co" title="chemical formula for the material or mixture" ></div>
              </td>
            </tr></tbody></table>
            </div>

            <div class="panel" id="activation-panel">
            <h3><span class="text">Neutron Activation</span></h3>
            <table><tbody><tr>
              <td rowspan="2" style="vertical-align: bottom">
               <label for="id_flux" class="control-label requiredField">Thermal flux</label>
              </td>
              <td colspan="2" style="text-align: center">For rabbit system</td>
            </tr>

            <tr>
              <td>
               <label for="id_Cd_ratio" class="control-label">Cd ratio</label>
              </td>
              <td>
               <label for="id_fast_ratio" class="control-label">Thermal/fast ratio</label>
              </td>
            </tr>


            <tr>
              <td>
               <div class="controls"><input id="id_flux" type="text" class="textinput textInput" name="flux" value="1e8" title="Thermal beam flux at sample"> </div>
              </td>
              <td>
               <div class="controls"><input id="id_Cd_ratio" type="text" class="textinput textInput" name="Cd_ratio" value="0" title="Cd ratio, or 0 if no epithermal neutrons."> </div>
              </td>
              <td>
               <div class="controls"><input id="id_fast_ratio" type="text" class="textinput textInput" name="fast_ratio" value="0" title="Thermal/fast neutron ratio, or 0 if no fast neutrons."> </div>
              </td>
            </tr>

            <tr>
              <td>
               <label for="id_mass" class="control-label">Mass</label>
              </td><td>
               <label for="id_time_on" class="control-label">Exposure</label>
              </td><td>
               <label for="id_time_off" class="control-label">Decay</label>
              </td>
            </tr>

            <tr>

              <td>
               <div class="controls"><input id="id_mass" type="text" class="textinput textInput" name="mass" value="" title="Sample mass.  Activation scales linearly with mass."></div>
              </td><td>
               <div class="controls"><input id="id_time_on" type="text" class="textinput textInput" name="time_on" value="10" title="Sample exposure time in hours, minutes, seconds, days, weeks or years."> </div>
              </td><td>
               <div class="controls"><input id="id_time_off" type="text" class="textinput textInput" name="time_off" value="1 y" title="Time since sample was removed from the beam.  0, 1 hour, 1 day and 15 days are automatically calculated"> </div>
              </td>
            </tr></tbody></table>
            <input type="submit" name="submit_act" value="Calculate" class="btn btn-primary" id="id_submit_act">
            </div>

            <div class="panel" id="scattering-panel">
            <h3><span class="text">Absorption and Scattering</span></h3>
            <table><tbody><tr>
              <td width="40%">
               <label for="id_density" class="control-label">Density</label>
              </td><td width="40%">
               <label for="id_thickness" class="control-label">Thickness</label>
              </td><td width="20%"></td>
            </tr><tr>
              <td>
               <div class="controls"><input id="id_density" type="text" class="textinput textInput" name="density" value="" title="Mass density as val or a:val b:val c:val (Å) alpha:val beta:val gamma:val (°)."></div>
              </td><td>
               <div class="controls"><input id="id_thickness" type="text" class="textinput textInput" name="thickness" value="1" title="Sample thickness for computing total scattering."></div>
              </td>
            </tr><tr>
              <td>
               <label for="id_wavelength" class="control-label">Source neutrons</label>
              </td><td>
               <label for="id_xray" class="control-label">Source X-rays</label>
              </td>
            </tr><tr>
              <td>
               <div class="controls"><input id="id_wavelength" type="text" class="textinput textInput" name="wavelength" value="1 Ang" title="Neutron source."></div>
              </td><td>
               <div class="controls"><input id="id_xray" type="text" class="textinput textInput" name="xray" value="Cu Ka" title="X-ray source."></div>
              </td>
            </tr></tbody></table>
            <input type="submit" name="submit_scat" value="Calculate" class="btn btn-primary" id="id_submit_scat">
            </div>
<!--
            <div id="div_id_abundance" class="control-group">
               <label for="id_abundance" class="control-label requiredField">Abundance (IAEA or NIST)</label>
               <div class="controls"><input id="id_abundance" type="text" class="textinput textInput" name="abundance" value="NIST"
                    title="Isotopic abundance for activation calculation uses either IAEA Report 273: Handbook of Nuclear Activation Data, 1987, or NIST Isotopic Composition of the Elements, 2001; sld and absorption calculations use NIST abundance."
               /> </div>
            </div>
-->
        </form>

    </div>
    <div id="help-frame" class="screen-only">
<div id="help_initial" class="help">
<h3>Neutron activation and scattering calculator</h3>
<p>
This calculator uses neutron cross sections to compute activation
on the sample given the mass in the sample and the time in the beam,
or to perform scattering calculations for the neutrons which are
not absorbed by the sample.
</p>
<ol>
<li>Enter the sample formula in the material panel.</li>
<li>To perform activation calculations, fill in the thermal
flux, the mass, the time on and off the beam, then press the
calculate button in the neutron activation panel.</li>
<li>To perform scattering calculations, fill in the wavelength
of the neutron and/or xrays, the thickness and the
density (if not given in the formula), then press the
calculate button in the absorption and scattering panel.</li>
</ol>
</div>

<!-- help for individual fields -->
<div id="help_chemical_formula" class="help">
<h3>Chemical formula</h3>
<p>The chemical formula parser allows you to specify materials and mixtures.
Formulas are parsed with
<a href="https://periodictable.readthedocs.io/en/latest/guide/formula_grammar.html">periodictable</a>
python package (<a class="cite" href="#ref_Kienzle">Kienzle 2008</a>).
</p>

<dl>
<dt>simple formula</dt>
<dd>A basic formula consists of elements and their quantities.
<div class="example"><div class="entrytext">CaCO3</div> represents the chemical CaCO<sub>3</sub></div>
</dd>

<dt>multi-part formula</dt>
<dd>Formulas can be built from parts by separating them with "+" or space,
    with a number before the part representing repeats.  Using parentheses,
    a formula is treated as if it were a single unit.
    <div class="example"><div class="entrytext">CaCO3+6H20</div>,
    <div class="entrytext">CaCO3 6H2O</div> and
    <div class="entrytext">CaCO3(H2O)6</div> all represent ikaite,
        CaCO<sub>3</sub>&middot;6H<sub>2</sub>O
    </div>
</dd>

<dt>isotopes</dt>
<dd>Isotopes are represented by element[nuclide index].
Special symbols <div class="entrytext">D</div> and
<div class="entrytext">T</div>
can be used for <sup>2</sup>H and <sup>3</sup>H.
Isotopes can be mixed within a formula, such as
<div class="entrytext">DHO</div> for partially deuterated water.
Use <div class="entrytext">H[1]</div> in formula for labile hydrogen.
These will be substituded with H and D in proportion with the D<sub>2</sub>O
fraction when computing the contrast match point of the sample.
<div class="example"><div class="entrytext">O[18]</div> represents the <sup>18</sup>O</div>
<div class="example"><div class="entrytext">C3H4H[1]NO@1.29n</div> represents alanine with one labile hydrogen.
</dd>

<dt>density</dt>
<dd>Mass density is needed to compute scattering factors for the material.
The density can be entered in the density field, or it can be given in
the formula by adding @value to the end.  Densities for the pure elements are
already known.
<div class="example"><div class="entrytext">H2O@1</div>
indicates that water has a density of 1 g/cm<sup>3</sup></div>
</dd>

<dt>isotopic density</dt>
<dd>If the formula uses a mixture of isotopes, you can still use the density
of the material assuming natural abundance, but add an "n" to the value
to scale it to the isotope specific density.  If you already know the
isotopic density, use the value by itself and it will not be scaled.
<div class="example"><div class="entrytext">D2O@1n</div>,
<div class="entrytext">D2O@1.11</div>, and
<div class="entrytext">D2O@1.11i</div>
all give the density of D<sub>2</sub>O as 1.11 g/cm<sup>3</sup></div>
</dd>

<dt>mole fractions</dt>
<dd>Using non-integer quantities, arbitrary concentration ratios can be
    be constructed.
    <div class="example"><div class="entrytext">78.2H2O[16] + 21.8H2O[18] @1n</div>
        represents water with 78.2% <sup>16</sup>O and 21.8% <sup>18</sup>O
    </div>
</dd>

<dt>mass fractions</dt>
<dd>Formulas can be mixed by mass, with each part starting with a percentage
    followed by formula followed by "//".  The first part must use "%wt" to
    indicate that it is a mass fraction.  The final part is the base, and it
    does not need a percentage since it makes up the rest of the material.
    <div class="example"><div class="entrytext">50%wt Co // Ti</div>
    is more descriptive than Co<sub>0.552</sub>Ti<sub>0.448</sub></div>
    <div class="example"><div class="entrytext">33%wt Co // 33% Fe // Ti</div>
    builds a 1:1:1 mixture by mass of cobalt-iron-titanium</div>
</dd>

<dt>volume fractions</dt>
<dd>Volume fractions are like mass fractions, but they use "%vol" instead.
    Each component of the volume fraction must specify the density.
    <div class="example"><div class="entrytext">20%vol (10%wt NaCl@2.16 // H2O@1) // D2O@1n</div>
        is a 10% saline solution by weight mixed 20:80 by volume with
        D<sub>2</sub>O, which is the same as
        <div class="entrytext">NaCl(H2O)29.1966(D2O)122.794@1.10i</div>
    </div>
</dd>

<dt>mass and volume mixtures</dt>
<dd>Specific amounts of materials can be mixed, with each part giving
    the quantity of material followed by "//".  Quantities can be masses
    (kg, g, mg, ug, or ng) or they can be volumes (L, mL, uL, nL).  Density
    is required for materials given by volume.  For scattering calculations
    density is required for the materials given by mass as well.
    <div class="example"><div class="entrytext">5g NaCl // 50mL H2O@1</div>
        is more descriptive than
        <div class="entrytext">NaCl(H2O)32.4407</div>
    </div>
    <div class="example"><div class="entrytext">5g NaCl@2.16 // 50mL H2O@1</div>
        computes the density as 1.05 g/cm<sup>3</sup>.  Not useful in this
        case since 9%wt brine has a density of 1.0633 at ambient temperature.
    </div>
    <div class="example"><div class="entrytext">50 mL (45 mL H2O@1 // 5 g NaCl)@1.0707 // 20 mL D2O@1n</div>
        uses the appropriate density for a 10%wt brine in the mixture.
    </div>
</dd>

<dt>layer thickness</dt>
<dd>Multilayer samples can specified as layer thickness and material separated
    by "//".  Thicknesses are in length units (cm, mm, um, nm).  The
    resulting material will compute activation for 1 cm<sup>2</sup> of material.
    Density is required for each layer.
    <div class="example"><div class="entrytext">1 cm Si // 5 nm Cr // 10 nm Au</div>
    </div>
</dd>
</dl>

<dt>biomolecules</dt>
<dd>
    For <a href="https://en.wikipedia.org/wiki/FASTA_format">FASTA</a> sequences
    use "code:sequence", where code is "aa" for amino acid sequences, "dna" for
    DNA sequences, or "rna" for RNA sequences.  Density is estimated automatically.
    This calculation uses <sup>1</sup>H for labile hydrogen, with substitution
    by H in natural abundance and pure D when computing contrast match point.
    <div class="example">&beta;-casein amino acid sequence <div class="entrytext">aa:RELEELNVPGEIVESLSSSEESITRINKKIEKFQSEEQQQTEDELQDKIHPFAQTQSLVYPFPGPIPNSLPQNIPPLTQTPVVVPPFLQPEVMGVSKVKEAMAPKHKEMPFPKYPVEPFTESQSLTLTDVENLHLPLPLLQSWMHQPHQPLPPTVMFPPQSVLSLSQSKVLPVPQKAVPYPQRDMPIQAFLLYQEPVLGPVRGPFPIIV</div></div>
</dd>
</div>

<div id="help_flux" class="help">
<h3>Thermal flux</h3>
<p>Units: n/cm<sup>2</sup>/s</p>
<p>
    Provide the thermal flux equivalent for the pre-sample beam configuration
    for the instrument.  This is only need for computing the neutron
    activation from the experiment, and is not used for computing scattering
    cross sections. Within the NCNR, you can access a list of
    <a href="http://www-i.ncnr.nist.gov/beamline_operations/instrument_fluxes.html">instrument fluxes</a>,
    but this is not available from outside.
</p>
<p>
    The neutron activation calculation follows (<a class="cite" href="#ref_Shleien">Shleien 1998</a>).
    Activation is a function of isotope, not element.  When
    an element is used in a formula, the natural abundance of the individual
    isotopes is used to determine the total activation.  By default, the
    activation calculator uses values from the IAEA
    handbook (<a class="cite" href="#ref_IAEA">IAEA 1987</a>), and the
    scattering calculator uses the NIST atomic weights and isotope composition
    database (<a class="cite" href="#ref_Bolke">Bölke 2005</a>).
</p>

<p>Calculation parameters are controlled by URL:</p>
<dl>
    <dt>isotope abundance</dt>
    <dd>
    The NIST database can be selected for isotope abundance using:
    <a href="index.html?abundance=NIST">index.html?abundance=NIST</a>
    </dd>

    <dt>activation cutoff</dt>
    <dd>
    The cutoff values for displaying activation data are set to 0.0005&thinsp;&mu;Ci
    by default.  The full activation levels
    can be displayed using: <a href="index.html?cutoff=0">index.html?cutoff=0</a>
    </dd>

    <dt>decay cutoff</dt>
    <dd>The activation calculator determines the amount of time for the activation to decay to
    the cutoff level, or to 0.0005&thinsp;&mu;Ci if cutoff is 0.  This can be set to a value
    such as 0.1&thinsp;&mu;Ci using: <a href="index.html?decay=0.1">index.html?decay=0.1</a>
    </dd>
</dl>

<p>Notes on calculation:</p>
<ul><li>
  For some numerical combinations with very large half-lives the numerical
  precision is inadequate and you get negative results. This can be
  corrected by reformulation or approximations but has not been done.
  Remember, the X in EXP(X) is limited to |X|&lt;709
</li><li>
  Simplifications have been made as indicated in the comments column in
  <a href="https://github.com/pkienzle/periodictable/blob/master/periodictable/activation.dat">data table</a>
</li><li>
  Typically, for a decay chain where the daughter is also produced (isomers)
  the s of the parent has been added to that of the daughter when the
  daughter t1/2 is much longer (true for most cases) and the parent
  t1/2 is relatively short, e.g. less than 1 day, so that all the daughter
  will be made relatively promptly.
</li><li>
  In cases where the above condition is not met an * is put next to the
  nuclide name to warn that the daughter production has not been accounted
  for. In most cases the daughter is in a simple decay equilibrium.
</li><li>
  Where the decay product is a new nuclide a line has been added to the
  database to account for this. This production mode is indicated in
  the reaction column by 'b'. Where both m and g state contribute to daughter
  production it is simplified to a single parent, that with the greater
  cross-section or that with the longer half-life together with the sum
  of the cross-sections.
</li><li>
  In a few cases where the parent nuclide t1/2 is very short all production
  is assigned to the daughter and no entry is made for the parent, as
  noted in the comments column.
</li><li>
  No correction for neutron burn up has been made.
</li><li>
  Most cross-section data is from IAEA 273.
</li><li>
  Fast neutron data from NBSIR 85-3151, Compendium of Benchmark Neutron Fields
  is for reaction above the Cd cutooff, .4eV. Noted in comment column.
</li><li>
  Fast neutron reaction data from IAEA 273 has been weighted by a unit fluence
  fast maxwellian spectrum as described in NBSIR 85-3151, but no further
  weighting for a 1/v or thermal component has been made. Only selected
  reactions have been included.
</li><li>
   Reaction = b indicates production via decay from an activation produced parent.
</li><li>
  Notation on reaction product name:
  <dl> <dt>m, m1, m2</dt> <dd>
    indicate metastable states. Decay may be the ground state or another nuclide.
  </dd> <dt>+</dt> <dd>
    indicates radioactive daughter production already included in daughter listing
    several parent t1/2's required to acheive calculated daughter activity.
    All activations are assigned at end of irradiation.
    In most cases the added activity to the daughter is small.
  </dd> <dt>*</dt> <dd>
    indicates radioactive daughter production NOT calculated, approx
    secular equilibrium.
  </dd> <dt>s</dt> <dd>
    indicates radioactive daughter of this nuclide in secular equilibrium
    after several daughter t1/2's.
  </dd> <dt>t</dt> <dd>
    indicates transient equil via beta decay. Accumulation of that nuclide
    during irradiation is separately calculated.
  </dd> </dl>
</li></ul>
</div>

<div id=help_Cd_ratio class="help">
    <h3>Cadmium ratio</h3>
    <p>Units: none</p>
    <p>
    Samples in the rabbit tubes can be shielded with cadmium to reduce the thermal
    flux while leaving the epithermal flux mostly unchanged.  The cadmium ratio
    determines the degree of reduction in the scattering cross sections, corresponding
    to the reduced flux.  This value is unitless.  Use a value of 0 for beamline
    experiments.
    </p>
</div>

<div id=help_fast_ratio class="help">
    <h3>Thermal/fast ratio</h3>
    <p>Units: none</p>
    <p>
    When performing neutron activation analysis in a rabbit tube, the additional
    fast neutron activations need to be determined.  The thermal/fast ratio is
    used to determine the fast neutron flux from the thermal flux equivalent for
    the given rabbit tube.  The resulting fast flux is (thermal flux)/(thermal/fast ratio).
    This value is unitless.  Use a value of 0 for beamline experiments.
    </p>
</div>

<div id="help_mass" class="help">
    <h3>Material mass</h3>
    <p>Units: g, kg, mg or ug</p>
    <p>
    The total neutron activation depends on the mass of the individual
    isotopes in the sample and the total time in the beam.  All activation
    calculations assume a thin plate sample, with all parts of the sample
    exposed to full flux during activation, and no self-shielding when
    estimating the activation level outside the beam.
    </p>
</div>

<div id=help_time_on class="help">
    <h3>Exposure</h3>
    <p>Units: h m s d w y</p>
    <p>
    Exposure is the duration of the exposure at the given flux. Activation
    will be accumulated over that time, with decay beginning the moment the
    sample is activated. Time defaults to hours, but can be set to
    hours, minutes, seconds, days, weeks or years by adding h, m, s, d, w, or y
    to the value respectively.
    </p>
</div>

<div id=help_time_off class="help">
    <h3>Decay</h3>
    <p>Units: h m s d w y OR yyyy-mm-dd hh:mm:ss</p>
    <p>
    The sample begins to decay immediately, even while it is being activated.
    The decay field allows you to specify how long since the sample
    was removed from the beam.  The default is hours, but can be set to
    hours, minutes, seconds, days, weeks or years by adding h, m, s, d, w, or y
    to the value respectively.
    We always compute the activation level when the sample is removed from the beam,
    and at 1 hour, 1 day and 15 days post activation.
    </p>
    <p>
    Instead of saying how long the sample activation has decayed, you can use
    the time that the sample was removed from the beam. Times are given as
        year-month-day hour:minute:second.
    Approximate times are allowed, such as 2010-03 for March, 2010.  This is
    equivalent to 2010-03-31 23:59:59, which is the end of March so that the
    activation estimate will be conservative.  This is the most activation
    consistent with the sample being on the beam sometime in March, 2010.
    Times are specified in US/Eastern.  Add "Z" after the time of day to
    indicate universal coordinated time (UTC), or add a timezone offset such
    as "+01" for +1 hours in France in winter, when daylight savings time is
    not in effect.
    </p>
    <p />
    <table>
    <tr><th class="timecol">If you type:</th><th>This is equivalent to:</th></tr>
    <tr><td class="timecol">2 m</td><td>2 minutes ago</td></tr>
    <tr><td class="timecol">1</td><td>1 hour ago</td></tr>
    <tr><td class="timecol">2.5w</td><td>2 and a half weeks ago</td></tr>
    <tr><td class="timecol">3 y</td><td>3 years ago</td></tr>
    <tr><td class="timecol">2015-01-02&nbsp;21:45:00</td><td>January 2, 2015 at 9:45 PM US/Eastern</td></tr>
    <tr><td class="timecol">2010-03</td><td>March 31, 2010 at 11:59:59 PM US/Eastern</td></tr>
    <tr><td class="timecol">2010-7-5&nbsp;12:23</td><td>July 5, 2010 at 12:23:59 PM US/Eastern</td></tr>
    <tr><td class="timecol">2015-01-02&nbsp;21:45:00Z</td><td>January 2, 2015 at 9:45 PM UTC</td></tr>
    <tr><td class="timecol">2015-01-02&nbsp;21:45:00-0600</td><td>January 2, 2015 at 9:45 PM US/Central</td></tr>
    <tr><td class="timecol">2015-08-02&nbsp;21:45:00-0500</td><td>August 2, 2015 at 9:45 PM US/Central</td></tr>
    <tr><td></td><td></td></tr>
    </table>
</div>

<div id="help_density" class="help">
    <h3>Mass density</h3>
    <p>Units: g/cm<sup>3</sup> or A3</p>
    <p>
    Density is used to compute absorption, transmission and scattering.
    <dl>
    <dt>from formula</dt>
    <dd>Leave the density field blank and add
    <div class="entrytext">@</div> + density
    to the end of the formula, where density is in g/cm<sup>3</sup>.
    For compounds with specific isotopes, you can use the density of the
    naturally occurring compound as
    <div class="entrytext">@</div> + density + <div class="entrytext">n</div>
    and the isotope specific density will be computed.  Density defaults to
    1 g/cm<sup>3</sup>, or for pure elements, the natural density given in
    the periodic table is used.

    <div class="example"><div class="entrytext">D2O@1n</div> or
    <div class="entrytext">D2O@1.11</div></div>
    </dd>
    <dt>g/cm<sup>3</sup></dt>
    <dd>Enter the density by itself, which will be interpreted as g/cm<sup>3</sup>, or
    equivalently, kg/L.  No units are needed.  If the value is
    density + <div class="entrytext">n</div> then it is density of the the
    naturally occuring compound and the isotopic density will be computed.
    <div class="example">D<sub>2</sub>O has a natural density of
    <div class="entrytext">1n</div> and an isotopic density of
    <div class="entrytext">1.11</div></div>
    </dd>
    <dt>cell volume</dt>
    <dd>Enter a number followed by A3 for &Aring;<sup>3</sup>.  Be sure that your
    formula contains the correct number of atoms for the unit cell, possibly by
    using n(formula), where n is 6 for hexagonal close packed, 4 for face centered
    cells, 2 for body centered and base centered cells, or 1 for simple cells.
    <div class="example">4NaCl has a cell volume of
    <div class="entrytext">179.4 A3</div></div>
    </dd>
    <dt>crystal lattice parameters</dt>
    <dd>Enter lattice parameters "a:n b:n c:n alpha:n beta:n gamma:n"
    where a, b, c are in &Aring; and &alpha;, &beta;, &gamma; are in degrees.
    If not specified, b and c default to a.  Ratios can also be used,
    so that "b/a:n" gives b=n*a, and "c/a:n" gives c=n*a.  Angles
    &alpha;, &beta;, and &gamma; default to 90&deg;.  Be sure that the
    formula contains the correct number of atoms for the unit cell.
    <div class="example">4NaCl has a cubic lattice with
    <div class="entrytext">a:5.6402</div></div>
    </dd>
    </dl>
</div>

<div id="help_thickness" class="help">
    <h3>Thickness</h3>
    <p>Units: cm</p>
    <p>
    The material thickness in cm is used to determine sample transmission,
    or how much beam will be absorbed by the sample or scattered incoherently.
    Leave it at 1 cm if you do not need this information.
    </p>
</div>

<div id=help_wavelength class="help">
    <h3>Source neutrons</h3>
    <p>Units: Ang, meV or m/s</p>
    <p>
    The energy of the source neutrons will affect the absorption cross section
    and hence the penetration depth and sample attenuation.  Energy can be
    expressed as wavelength in &Aring;, as energy in meV, or as neutron
    velocity in m/s.
    Neutron cross sections are tabulated
    at 1.798&nbsp;&Aring; = 25.3 meV = 2200 m/s, with an assumed 1/v dependence for
    the absorption cross section (<a class="cite" href="#ref_Rauch">Rauch 2003</a>,
    <a class="cite" href="#ref_Sears">Sears 2006</a>).
    </p><p>
    For heavier isotopes (Cd, Hf, rare earths) and/or shorter wavelengths
    (below 1&nbsp;&Aring;) there are neutron <a href="resonance.html">resonances</a>
    in the thermal range. For rare-earth elements the energy-dependent coherent
    sld is calculated following scattering length values tabulated
    in <a class="cite" href="#ref_Lynn1992">Lynn and Seeger 1992</a>. Incoherent
    scattering will be understimated for these elements. 
    </p><p>
    There is also a wavelength dependence for single phonon interactions which
    gives rise to significant inelastic scattering for lighter isotopes (H, D)
    and/or longer wavelengths (above 5&nbsp;&Aring;). This factor is both
    temperature and material dependent and will not be included
    in the scattering calculations. In particular, penetration length and
    transmitted flux are going to be significantly overestimated.
    </p>
</div>

<div id=help_xray class="help">
    <h3>Source X-rays</h3>
    <p>Units: Ang, keV or Ka</p>
    <p>
    X-ray absorption and scattering are computed from the energy dependent
    atomic scattering factors (<a class="cite" href="#ref_Henke">Henke 1993</a>).
    Energy can be expressed as wavelength in &Aring;, as energy in keV, or
    using an element name for the K<sub>&alpha;</sub> emission line<sup>2</sup> for
    that element (<a class="cite" href="#ref_Deslattes">Deslattes 2003</a>).
    </p>
</div>

<div id="help_references" class="help">
    <h3>References</h3>
    <ol>
    <li id="ref_Bolke">
        Bölke, et al. (2005).
        <em>Isotopic Compositions of the Elements, 2001.</em>
        J. Phys. Chem. Ref. Data, Vol. 34, No. 1, 2005
        [<a href="http://www.nist.gov/pml/data/comp.cfm">abundance data</a>]
    </li>
    <li id="ref_Deslattes">
        Deslattes, R.D.; Kessler, Jr., E.G.; Indelicato, P.; de Billy, L.; Lindroth, E. and Anton, J. (2003).
        Rev. Mod. Phys. 75, 35-99.
        [<a href="http://www.nist.gov/pml/data/xraytrans/index.cfm">xray emission lines</a>]
    </li>
    <li id="ref_Henke">
        Henke, B.L.; Gullikson, E.M. and Davis, J.C. (1993).
        <em>X-ray interactions:
        photoabsorption, scattering, transmission, and reflection at E=50-30000 eV, Z=1-92,</em>
        Atomic Data and Nuclear Data Tables Vol. 54 (no.2), 181-342.
        [<a href="http://henke.lbl.gov/optical_constants/">xray cross sections</a>]
    </li>
    <li id="ref_IAEA">
        IAEA (1987).
        <em>Handbook on Nuclear Activation Data.</em>
        TR 273 (International Atomic Energy Agency, Vienna, Austria).
        [<a href="http://cds.cern.ch/record/111089/files/IAEA-TR-273.pdf">tech report</a>]
    </li>
    <!-- TODO: query activation server for periodictable version number -->
    <li id="ref_Kienzle">
        Kienzle, P. A. (2008-2019).
        <em>Extensible periodic table (v1.5.2).</em>
        Computer Software.
        <a href="https://periodictable.readthedocs.io">https://periodictable.readthedocs.io</a>.
        [<a href="https://github.com/pkienzle/periodictable">calculator source</a>,
        <a href="https://github.com/scattering/activation">web service source</a>]
    </li>
    <li id="ref_Lynn1992">
        Lynn, J.E. and Seeger, P.A. (1990).
        <em>Resonance effects in neutron scattering lengths of rare-earth nuclides.</em>
        Atomic Data and Nuclear Data Tables 44, 191-207.
        doi:10.1016/0092-640X(90)90013-A
        [<a href="https://dx.doi.org/10.1016/0092-640X(90)90013-A">rare earth scattering lengths</a>]
    <li id="ref_Rauch">
        Rauch, H. and Waschkowski, W. (2003).
        <em>Neutron Scattering Lengths in ILL Neutron Data Booklet (second edition),</em>
        A.-J. Dianoux, G. Lander, Eds.
        Old City Publishing, Philidelphia, PA. pp 1.1-1 to 1.1-17.
        [<a href="https://www.ill.eu/fileadmin/user_upload/ILL/1_About_ILL/Documentation/NeutronDataBooklet.pdf">booklet</a>,
        <a href="http://www.ati.ac.at/~neutropt/scattering/Scattering_lengths_table_20010419.pdf">neutron cross sections</a>]
    </li>
    <li id="ref_Sears">
        Sears, V. F. (2006). "Scattering lengths for neutrons" In Prince, E. Ed.
        <em>International Tables for Crystallography Volume C: Mathematical, Physical and Chemical Tables"</em>
        Kluwer Academic Publishers, pp 444-454.
        doi:10.1107/97809553602060000103
        [<a href="https://it.iucr.org/Cb/ch4o4v0001/sec4o4o4/">scattering calculations</a>]
    </li>
    <li id="ref_Shleien">
        Shleien, B.; Slaback, L.A. and Birky, B.K. (1998).
        <em>Handbook of health physics and radiological health.</em>
        Williams & Wilkins, Baltimore.
        [<a href="https://github.com/pkienzle/periodictable/blob/master/periodictable/activation.dat">activation data</a>]
    </li>
    </ol>
</div>

<div id="help_history" class="help">
    <h3>History</h3>
    <dl class="inline">
    <dt>2022-05-18</dt><dd>Fix decay time calculation for long-lived isotopes and activation calculation for Eu.
        <br />Use standard year as 365 days when reporting activation times.
        <br />Improve style sheets for mobile and print.
        <br />Remove possible cross-site scripting attack vector.
    </dd>
    <dt>2021-04-21</dt><dd>Support energy-dependent rare earth elements.
        <br />Use complex scattering length b<sub>c</sub> when computing
              σ<sub>c</sub> = 4π&thinsp;|b<sub>c</sub>|<sup>2</sup>/100 and
              σ<sub>i</sub> = σ<sub>s</sub> - σ<sub>c</sub>.
    </dd>
    <dt>2020-10-29</dt><dd>Change field labels from 'time on/off beam' to 'exposure/decay duration'.</dd>
    <dt>2020-01-22</dt><dd>Restore support for Internet Explorer 10 and 11.</dd>
    <dt>2019-12-02</dt><dd>Fix cutoff=0 handling in URL.</dd>
    <dt>2019-11-14</dt><dd>Correct units on activity table: nCi becomes uCi.
        <br />Elemental carbon density changed to 2.2 to match CXRO, CRC and RSC.
    </dd>
    <dt>2019-11-04</dt><dd>Update neutron refs with links to ILL data book and Table for Crystallography.</dd>
    <dt>2019-09-16</dt><dd>Improve help system: can now scroll between sections.</dd>
    <dt>2019-09-11</dt><dd>Include notes on activation calculation.</dd>
    <dt>2019-08-27</dt><dd>Change default cutoff to 0.5 nCi.</dd>
    <dt>2018-01-12</dt><dd>Make activation table sortable.</dd>
    <dt>2017-05-11</dt><dd>Improved support for printing tables.
        <br />Support for biomolecules with labile hydrogen (FASTA format).
        <br />Mixture by mass and volume, e.g., <code>5 g NaCl // 50 mL H2O@1</code>
        <br />Multi-layer materials, e.g., <code>5 um Si // 3 nm Cr // 8 nm Au</code>
        <br />Compute incoherent cross section from coherent and total.
    </dd>
    <dt>2016-12-07</dt><dd>Use exponential notation for all activity levels.</dd>
    <dt>2015-10-20</dt><dd>Allow decay time to be calculated from timestamp..</dd>
    <dt>2014-03-20</dt><dd>Default to isotopic density.</dd>
    <dt>2013-11-05</dt><dd>Support for X-ray scattering.</dd>
    <dt>2013-04-17</dt><dd>Initial release.</dd>
    </dl>
</div>

<!-- end of help -->

    </div>

    <div id="results-frame">
        <h3 class="print-only">Activation and Scattering Results</h3>
        <div id="results"></div>
    </div>
</div>

<hr>
<div id="footer">
    <div id="footer-left"><p>
        <em>Questions?</em><br>
        Neutron activation: NCNR Health Physics &lt;<a href="mailto:hp@nist.gov">hp@nist.gov</a>&gt;<br>
        Scattering calculations: Paul Kienzle &lt;<a href="mailto:paul.kienzle@nist.gov">paul.kienzle@nist.gov</a>&gt;
        </p></div>
    <!-- <div id="footer-right"><p><?php lastmod(); ?></p></div> -->
    <div id="footer-right">
        <p>Last modified <span id="lastmod-timestamp"></span> by website owner: NCNR</p>
    </div>
</div>

</body></html>
